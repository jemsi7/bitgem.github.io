<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë² ì´ì§€ì•ˆ ì•”í˜¸í™”í ê°€ê²© ì˜ˆì¸¡ ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <div class="min-h-screen p-6">
        <div class="max-w-7xl mx-auto">
            <!-- í—¤ë” -->
            <div class="mb-8">
                <h1 class="text-4xl font-bold mb-4 text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-600">
                    ë² ì´ì§€ì•ˆ ì•”í˜¸í™”í ê°€ê²© ì˜ˆì¸¡ ëŒ€ì‹œë³´ë“œ
                </h1>
                <div class="flex items-center gap-4">
                    <p class="text-gray-400">Binance ì‹¤ì‹œê°„ ë°ì´í„° ê¸°ë°˜ ì˜ˆì¸¡</p>
                    <div class="flex items-center gap-2 text-sm text-gray-500">
                        <span>ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: </span>
                        <span id="lastUpdate">-</span>
                    </div>
                </div>
            </div>

            <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
            <div id="errorMessage" class="mb-6 bg-red-900 bg-opacity-20 border border-red-500 rounded-lg p-4 hidden">
                <span class="text-red-400"></span>
            </div>

            <!-- ì•”í˜¸í™”í ì„ íƒ -->
            <div class="flex gap-4 mb-6">
                <button onclick="selectCrypto('BTCUSDT')" id="btnBTC" 
                    class="px-6 py-3 rounded-lg font-semibold transition-all bg-orange-500 text-white shadow-lg shadow-orange-500/50">
                    ë¹„íŠ¸ì½”ì¸ (BTC/USDT)
                </button>
                <button onclick="selectCrypto('ETHUSDT')" id="btnETH"
                    class="px-6 py-3 rounded-lg font-semibold transition-all bg-gray-800 text-gray-400 hover:bg-gray-700">
                    ì´ë”ë¦¬ì›€ (ETH/USDT)
                </button>
            </div>

            <!-- ë¡œë”© -->
            <div id="loading" class="flex items-center justify-center h-64">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-400"></div>
            </div>

            <!-- ë©”ì¸ ì»¨í…ì¸  -->
            <div id="mainContent" class="hidden">
                <!-- ì •ë³´ ì¹´ë“œë“¤ -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <!-- í˜„ì¬ ê°€ê²© -->
                    <div class="bg-gray-800 rounded-xl p-6 shadow-xl">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-400">í˜„ì¬ ê°€ê²© (ì‹¤ì‹œê°„)</h3>
                            <span class="text-2xl">ğŸ’²</span>
                        </div>
                        <p class="text-3xl font-bold" id="currentPrice">-</p>
                        <p class="text-sm text-gray-500 mt-2">Binance <span id="cryptoSymbol">BTC</span>/USDT</p>
                    </div>

                    <!-- ì˜ˆì¸¡ ê°€ê²© -->
                    <div class="bg-gray-800 rounded-xl p-6 shadow-xl border-2 border-blue-500">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-400">ë‚´ì¼ ì˜ˆì¸¡ ê°€ê²©</h3>
                            <span class="text-2xl" id="trendIcon">ğŸ“ˆ</span>
                        </div>
                        <p class="text-3xl font-bold text-blue-400" id="predictedPrice">-</p>
                        <div class="flex items-center gap-2 mt-2">
                            <span class="text-sm font-semibold" id="priceChange">-</span>
                            <span class="text-sm text-gray-500">ì‹ ë¢°ë„: <span id="confidence">-</span>%</span>
                        </div>
                        <p class="text-xs text-gray-500 mt-2" id="priceRange">-</p>
                    </div>

                    <!-- ì‹œì¥ ìƒíƒœ -->
                    <div class="bg-gray-800 rounded-xl p-6 shadow-xl">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-400">ì‹œì¥ ìƒíƒœ</h3>
                            <span class="text-2xl">ğŸ“Š</span>
                        </div>
                        <p class="text-3xl font-bold" id="marketTrend">-</p>
                        <p class="text-sm text-gray-500 mt-2" id="rsiStatus">RSI: -</p>
                    </div>
                </div>

                <!-- ì˜¤ëŠ˜ì˜ ì‹œê°„ëŒ€ë³„ ì˜ˆì¸¡ -->
                <div class="bg-gray-800 rounded-xl p-6 shadow-xl mb-8">
                    <h3 class="text-xl font-semibold mb-6">ì˜¤ëŠ˜ì˜ ì‹œê°„ëŒ€ë³„ í‰ê·  ì˜ˆì¸¡ê°€</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="bg-gray-700 rounded-lg p-4">
                            <h4 class="text-sm text-gray-400 mb-2">5ë¶„ í‰ê· </h4>
                            <p class="text-xl font-bold" id="avg5m">-</p>
                            <p class="text-xs mt-1" id="change5m">-</p>
                        </div>
                        <div class="bg-gray-700 rounded-lg p-4">
                            <h4 class="text-sm text-gray-400 mb-2">30ë¶„ í‰ê· </h4>
                            <p class="text-xl font-bold" id="avg30m">-</p>
                            <p class="text-xs mt-1" id="change30m">-</p>
                        </div>
                        <div class="bg-gray-700 rounded-lg p-4">
                            <h4 class="text-sm text-gray-400 mb-2">1ì‹œê°„ í‰ê· </h4>
                            <p class="text-xl font-bold" id="avg1h">-</p>
                            <p class="text-xs mt-1" id="change1h">-</p>
                        </div>
                        <div class="bg-gray-700 rounded-lg p-4">
                            <h4 class="text-sm text-gray-400 mb-2">4ì‹œê°„ í‰ê· </h4>
                            <p class="text-xl font-bold" id="avg4h">-</p>
                            <p class="text-xs mt-1" id="change4h">-</p>
                        </div>
                    </div>
                </div>

                <!-- ì°¨íŠ¸ -->
                <div class="bg-gray-800 rounded-xl p-6 shadow-xl mb-8">
                    <h3 class="text-xl font-semibold mb-6">30ì¼ ê°€ê²© ì¶”ì´ ë° ì˜ˆì¸¡</h3>
                    <div style="aspect-ratio: 16/9; width: 100%;">
                        <canvas id="priceChart"></canvas>
                    </div>
                </div>

                <!-- í†µê³„ ì •ë³´ -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- ìˆ˜ìµë¥  í†µê³„ -->
                    <div class="bg-gray-800 rounded-xl p-6 shadow-xl">
                        <h3 class="text-lg font-semibold mb-4">ìˆ˜ìµë¥  í†µê³„ (30ì¼)</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-gray-400">í‰ê·  ì¼ì¼ ìˆ˜ìµë¥ </span>
                                <span class="font-semibold" id="meanReturn">-</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">ë³€ë™ì„± (ì¼ì¼)</span>
                                <span class="font-semibold" id="volatility">-</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">ì™œë„ (Skewness)</span>
                                <span class="font-semibold" id="skewness">-</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">ì²¨ë„ (Kurtosis)</span>
                                <span class="font-semibold" id="kurtosis">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- ê¸°ìˆ ì  ì§€í‘œ -->
                    <div class="bg-gray-800 rounded-xl p-6 shadow-xl">
                        <h3 class="text-lg font-semibold mb-4">ê¸°ìˆ ì  ì§€í‘œ</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-gray-400">RSI (14ì¼)</span>
                                <span class="font-semibold" id="rsiValue">-</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">ëª¨ë©˜í…€ (5ì¼)</span>
                                <span class="font-semibold" id="momentum">-</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">ì¶”ì„¸ ê°•ë„</span>
                                <div class="w-24 bg-gray-700 rounded-full h-2">
                                    <div id="trendStrength" class="h-2 rounded-full bg-green-400 transition-all" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">ì‹œì¥ ìƒíƒœ</span>
                                <span class="font-semibold" id="marketStatus">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ëª¨ë¸ ì„¤ëª… -->
                <div class="mt-8 bg-gray-800 rounded-xl p-6 shadow-xl">
                    <h3 class="text-lg font-semibold mb-4">ë² ì´ì§€ì•ˆ ì¶”ë¡  ëª¨ë¸</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-400">
                        <div>
                            <h4 class="text-white font-semibold mb-2">ì‚¬ì „ ë¶„í¬ (Prior)</h4>
                            <p>Binance 30ì¼ ì‹¤ì œ ê°€ê²© ë°ì´í„° ê¸°ë°˜ ìˆ˜ìµë¥ ê³¼ ë³€ë™ì„± ë¶„í¬ ì„¤ì •</p>
                        </div>
                        <div>
                            <h4 class="text-white font-semibold mb-2">ìš°ë„ (Likelihood)</h4>
                            <p>Student-t ë¶„í¬ë¡œ ê·¹ë‹¨ì  ê°€ê²© ë³€ë™ ëª¨ë¸ë§, Inverse Gammaë¡œ ë³€ë™ì„± ì¶”ì •</p>
                        </div>
                        <div>
                            <h4 class="text-white font-semibold mb-2">ì‚¬í›„ ë¶„í¬ (Posterior)</h4>
                            <p>RSI, ëª¨ë©˜í…€ ë“± ì‹¤ì‹œê°„ ê¸°ìˆ ì  ì§€í‘œë¥¼ ê²°í•©í•œ ìµœì¢… ì˜ˆì¸¡ ë¶„í¬ ìƒì„±</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let selectedCrypto = 'BTCUSDT';
        let priceData = [];
        let currentPrice = 0;
        let chart = null;
        let ws = null;
        let intradayPrices = []; // ì˜¤ëŠ˜ì˜ ê°€ê²© ë°ì´í„°
        let intradayStartTime = null;

        // Binance API ì„¤ì • - ì§ì ‘ í˜¸ì¶œ (CORS í—ˆìš©ë¨)
        const BINANCE_API = 'https://api.binance.com/api/v3';

        // ë² ì´ì§€ì•ˆ íŒŒë¼ë¯¸í„°
        const studentTParams = {
            BTCUSDT: { df: 3, loc: 0.001, scale: 0.02 },
            ETHUSDT: { df: 3, loc: 0.0015, scale: 0.025 }
        };

        const invGammaParams = {
            BTCUSDT: { shape: 2.5, scale: 0.0004 },
            ETHUSDT: { shape: 2.5, scale: 0.0006 }
        };

        // ì•”í˜¸í™”í ì„ íƒ
        function selectCrypto(symbol) {
            selectedCrypto = symbol;
            
            // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            if (symbol === 'BTCUSDT') {
                document.getElementById('btnBTC').className = 'px-6 py-3 rounded-lg font-semibold transition-all bg-orange-500 text-white shadow-lg shadow-orange-500/50';
                document.getElementById('btnETH').className = 'px-6 py-3 rounded-lg font-semibold transition-all bg-gray-800 text-gray-400 hover:bg-gray-700';
                document.getElementById('cryptoSymbol').textContent = 'BTC';
            } else {
                document.getElementById('btnETH').className = 'px-6 py-3 rounded-lg font-semibold transition-all bg-blue-500 text-white shadow-lg shadow-blue-500/50';
                document.getElementById('btnBTC').className = 'px-6 py-3 rounded-lg font-semibold transition-all bg-gray-800 text-gray-400 hover:bg-gray-700';
                document.getElementById('cryptoSymbol').textContent = 'ETH';
            }
            
            // ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
            loadData();
        }

        // ê³¼ê±° ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        async function fetchHistoricalData() {
            try {
                const endTime = Date.now();
                const startTime = endTime - (30 * 24 * 60 * 60 * 1000);
                
                // Binance APIëŠ” CORSë¥¼ í—ˆìš©í•˜ë¯€ë¡œ ì§ì ‘ í˜¸ì¶œ ê°€ëŠ¥
                const url = `${BINANCE_API}/klines?symbol=${selectedCrypto}&interval=1d&startTime=${startTime}&endTime=${endTime}&limit=30`;
                
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`API í˜¸ì¶œ ì‹¤íŒ¨: ${response.status}`);
                }
                
                const klines = await response.json();
                
                return klines.map(kline => {
                    const date = new Date(kline[0]);
                    return {
                        date: date.toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' }),
                        price: parseFloat(kline[4]) // close price
                    };
                });
            } catch (err) {
                console.error('Historical data fetch error:', err);
                
                // ëŒ€ì²´ ë°©ë²•: CoinGecko API ì‚¬ìš© (CORS í—ˆìš©)
                try {
                    console.log('Binance API ì‹¤íŒ¨, CoinGecko API ì‹œë„ ì¤‘...');
                    const coinId = selectedCrypto === 'BTCUSDT' ? 'bitcoin' : 'ethereum';
                    const cgUrl = `https://api.coingecko.com/api/v3/coins/${coinId}/market_chart?vs_currency=usd&days=30&interval=daily`;
                    
                    const response = await fetch(cgUrl);
                    if (!response.ok) throw new Error('CoinGecko API í˜¸ì¶œ ì‹¤íŒ¨');
                    
                    const data = await response.json();
                    return data.prices.map(([timestamp, price]) => {
                        const date = new Date(timestamp);
                        return {
                            date: date.toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' }),
                            price: price
                        };
                    });
                } catch (cgErr) {
                    console.error('CoinGecko API error:', cgErr);
                    showError('ê³¼ê±° ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                    return [];
                }
            }
        }

        // í˜„ì¬ ê°€ê²© ê°€ì ¸ì˜¤ê¸°
        async function fetchCurrentPrice() {
            try {
                // Binance API ì§ì ‘ í˜¸ì¶œ
                const url = `${BINANCE_API}/ticker/price?symbol=${selectedCrypto}`;
                
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error('Binance ê°€ê²© ì •ë³´ í˜¸ì¶œ ì‹¤íŒ¨');
                }
                
                const data = await response.json();
                return parseFloat(data.price);
            } catch (err) {
                console.error('Current price fetch error:', err);
                
                // ëŒ€ì²´: CoinGecko API
                try {
                    const coinId = selectedCrypto === 'BTCUSDT' ? 'bitcoin' : 'ethereum';
                    const cgUrl = `https://api.coingecko.com/api/v3/simple/price?ids=${coinId}&vs_currencies=usd`;
                    
                    const response = await fetch(cgUrl);
                    if (!response.ok) throw new Error('CoinGecko API ì‹¤íŒ¨');
                    
                    const data = await response.json();
                    return data[coinId].usd;
                } catch (cgErr) {
                    console.error('CoinGecko price error:', cgErr);
                    return null;
                }
            }
        }

        // WebSocket ì—°ê²°
        function connectWebSocket() {
            if (ws) ws.close();
            
            const wsUrl = `wss://stream.binance.com:9443/ws/${selectedCrypto.toLowerCase()}@ticker`;
            ws = new WebSocket(wsUrl);
            
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                currentPrice = parseFloat(data.c);
                updateCurrentPrice();
                document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString('ko-KR');
            };
        }

        // Student-t ë¶„í¬ ìƒ˜í”Œë§
        function sampleStudentT(df, loc, scale) {
            const u1 = Math.random();
            const u2 = Math.random();
            const z = Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);
            
            let chi2 = 0;
            for (let i = 0; i < df; i++) {
                const n = Math.random();
                chi2 += Math.pow(Math.sqrt(-2 * Math.log(n)) * Math.cos(2 * Math.PI * Math.random()), 2);
            }
            
            const t = z / Math.sqrt(chi2 / df);
            return loc + scale * t;
        }

        // ì˜¤ëŠ˜ì˜ ì‹œê°„ëŒ€ë³„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        async function fetchIntradayData(interval) {
            try {
                const now = Date.now();
                let limit;
                switch(interval) {
                    case '5m': limit = 12; break; // 1ì‹œê°„ì¹˜
                    case '30m': limit = 48; break; // 24ì‹œê°„ì¹˜
                    case '1h': limit = 24; break; // 24ì‹œê°„ì¹˜
                    case '4h': limit = 6; break; // 24ì‹œê°„ì¹˜
                }
                
                const url = `${BINANCE_API}/klines?symbol=${selectedCrypto}&interval=${interval}&limit=${limit}`;
                const response = await fetch(url);
                
                if (!response.ok) throw new Error(`Failed to fetch ${interval} data`);
                
                const klines = await response.json();
                return klines.map(k => parseFloat(k[4])); // close prices
            } catch (err) {
                console.error(`Intraday ${interval} fetch error:`, err);
                return [];
            }
        }

        // ì‹œê°„ëŒ€ë³„ í‰ê·  ì˜ˆì¸¡ ê³„ì‚°
        async function calculateIntradayPredictions() {
            const intervals = ['5m', '30m', '1h', '4h'];
            
            for (const interval of intervals) {
                const prices = await fetchIntradayData(interval);
                if (prices.length > 0) {
                    // í‰ê·  ê³„ì‚°
                    const avg = prices.reduce((a, b) => a + b, 0) / prices.length;
                    
                    // ë³€í™”ìœ¨ ê³„ì‚°
                    const change = ((prices[prices.length - 1] - prices[0]) / prices[0] * 100).toFixed(2);
                    
                    // ê°„ë‹¨í•œ ì„ í˜• ì¶”ì„¸ ê¸°ë°˜ ì˜ˆì¸¡
                    const trend = (prices[prices.length - 1] - prices[0]) / prices.length;
                    const predicted = prices[prices.length - 1] + trend;
                    
                    // UI ì—…ë°ì´íŠ¸
                    updateIntradayUI(interval, predicted, change);
                }
            }
        }

        // ì‹œê°„ëŒ€ë³„ ì˜ˆì¸¡ UI ì—…ë°ì´íŠ¸
        function updateIntradayUI(interval, predicted, change) {
            let elementId, changeId;
            switch(interval) {
                case '5m': 
                    elementId = 'avg5m'; 
                    changeId = 'change5m';
                    break;
                case '30m': 
                    elementId = 'avg30m';
                    changeId = 'change30m';
                    break;
                case '1h': 
                    elementId = 'avg1h';
                    changeId = 'change1h';
                    break;
                case '4h': 
                    elementId = 'avg4h';
                    changeId = 'change4h';
                    break;
            }
            
            document.getElementById(elementId).textContent = 
                `${predicted.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            
            const changeElement = document.getElementById(changeId);
            changeElement.textContent = `${change > 0 ? '+' : ''}${change}%`;
            changeElement.className = `text-xs mt-1 ${change > 0 ? 'text-green-400' : 'text-red-400'}`;
        }

        // RSI ê³„ì‚°
        function calculateRSI(prices) {
            if (prices.length < 14) return 50;
            
            const gains = [];
            const losses = [];
            
            for (let i = 1; i < prices.length; i++) {
                const diff = prices[i] - prices[i-1];
                if (diff > 0) {
                    gains.push(diff);
                    losses.push(0);
                } else {
                    gains.push(0);
                    losses.push(Math.abs(diff));
                }
            }
            
            const avgGain = gains.slice(-14).reduce((a, b) => a + b, 0) / 14;
            const avgLoss = losses.slice(-14).reduce((a, b) => a + b, 0) / 14;
            
            if (avgLoss === 0) return 100;
            const rs = avgGain / avgLoss;
            return 100 - (100 / (1 + rs));
        }

        // ë² ì´ì§€ì•ˆ ì˜ˆì¸¡
        function bayesianPredict() {
            if (priceData.length < 2) return null;
            
            const prices = priceData.map(d => d.price);
            const returns = [];
            
            // ìˆ˜ìµë¥  ê³„ì‚°
            for (let i = 1; i < prices.length; i++) {
                returns.push((prices[i] - prices[i-1]) / prices[i-1]);
            }
            
            // í†µê³„ ê³„ì‚°
            const mean = returns.reduce((a, b) => a + b, 0) / returns.length;
            const variance = returns.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / returns.length;
            const volatility = Math.sqrt(variance);
            
            // ì™œë„ ê³„ì‚°
            const skewness = returns.reduce((a, b) => a + Math.pow((b - mean) / volatility, 3), 0) / returns.length;
            
            // ì²¨ë„ ê³„ì‚°
            const kurtosis = returns.reduce((a, b) => a + Math.pow((b - mean) / volatility, 4), 0) / returns.length - 3;
            
            // RSI ê³„ì‚°
            const rsi = calculateRSI(prices);
            
            // ëª¨ë©˜í…€ ê³„ì‚°
            const momentum = prices.length >= 5 ? 
                (prices[prices.length - 1] - prices[prices.length - 5]) / prices[prices.length - 5] : 0;
            
            // ë² ì´ì§€ì•ˆ ì—…ë°ì´íŠ¸
            const params = studentTParams[selectedCrypto];
            const volParams = invGammaParams[selectedCrypto];
            
            const posteriorLoc = (params.loc + mean) / 2;
            const posteriorScale = params.scale * (1 + Math.abs(skewness) * 0.1);
            
            // ì˜ˆì¸¡
            const predictedReturn = sampleStudentT(params.df, posteriorLoc, posteriorScale);
            const predictedVolatility = sampleInverseGamma(volParams.shape, volParams.scale);
            
            // RSI ì¡°ì •
            let adjustment = 1;
            if (rsi > 70) adjustment = 0.95;
            else if (rsi < 30) adjustment = 1.05;
            
            const lastPrice = currentPrice || prices[prices.length - 1];
            const predictedPrice = lastPrice * (1 + predictedReturn * adjustment);
            
            const confidence = Math.max(0.6, Math.min(0.95, 1 - predictedVolatility * 10));
            const upperBound = predictedPrice * (1 + 1.96 * posteriorScale);
            const lowerBound = predictedPrice * (1 - 1.96 * posteriorScale);
            
            return {
                price: predictedPrice,
                upperBound,
                lowerBound,
                confidence,
                statistics: {
                    mean: (mean * 100).toFixed(2),
                    volatility: (volatility * 100).toFixed(2),
                    skewness: skewness.toFixed(3),
                    kurtosis: kurtosis.toFixed(3)
                },
                indicators: {
                    rsi: rsi.toFixed(1),
                    momentum: (momentum * 100).toFixed(2),
                    trend: momentum > 0 ? 'bullish' : 'bearish'
                }
            };
        }

        // UI ì—…ë°ì´íŠ¸
        function updateUI(prediction) {
            if (!prediction) return;
            
            // ì˜ˆì¸¡ ê°€ê²©
            document.getElementById('predictedPrice').textContent = 
                `$${prediction.price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            
            // ê°€ê²© ë³€í™”
            const priceChange = ((prediction.price - currentPrice) / currentPrice * 100).toFixed(2);
            const changeElement = document.getElementById('priceChange');
            changeElement.textContent = `${priceChange > 0 ? '+' : ''}${priceChange}%`;
            changeElement.className = `text-sm font-semibold ${priceChange > 0 ? 'text-green-400' : 'text-red-400'}`;
            
            // íŠ¸ë Œë“œ ì•„ì´ì½˜
            document.getElementById('trendIcon').textContent = priceChange > 0 ? 'ğŸ“ˆ' : 'ğŸ“‰';
            
            // ì‹ ë¢°ë„
            document.getElementById('confidence').textContent = (prediction.confidence * 100).toFixed(1);
            
            // ê°€ê²© ë²”ìœ„
            document.getElementById('priceRange').textContent = 
                `ë²”ìœ„: $${prediction.lowerBound.toFixed(2)} - $${prediction.upperBound.toFixed(2)}`;
            
            // ì‹œì¥ íŠ¸ë Œë“œ
            const trendElement = document.getElementById('marketTrend');
            trendElement.textContent = prediction.indicators.trend === 'bullish' ? 'ìƒìŠ¹ì„¸' : 'í•˜ë½ì„¸';
            trendElement.className = `text-3xl font-bold ${prediction.indicators.trend === 'bullish' ? 'text-green-400' : 'text-red-400'}`;
            
            // RSI ìƒíƒœ
            document.getElementById('rsiStatus').textContent = `RSI: ${prediction.indicators.rsi}`;
            
            // í†µê³„
            document.getElementById('meanReturn').textContent = `${prediction.statistics.mean}%`;
            document.getElementById('meanReturn').className = `font-semibold ${parseFloat(prediction.statistics.mean) > 0 ? 'text-green-400' : 'text-red-400'}`;
            document.getElementById('volatility').textContent = `${prediction.statistics.volatility}%`;
            document.getElementById('skewness').textContent = prediction.statistics.skewness;
            document.getElementById('kurtosis').textContent = prediction.statistics.kurtosis;
            
            // ê¸°ìˆ ì  ì§€í‘œ
            document.getElementById('rsiValue').textContent = prediction.indicators.rsi;
            document.getElementById('rsiValue').className = `font-semibold ${
                prediction.indicators.rsi > 70 ? 'text-red-400' : 
                prediction.indicators.rsi < 30 ? 'text-green-400' : 'text-white'
            }`;
            
            document.getElementById('momentum').textContent = `${prediction.indicators.momentum}%`;
            document.getElementById('momentum').className = `font-semibold ${
                parseFloat(prediction.indicators.momentum) > 0 ? 'text-green-400' : 'text-red-400'
            }`;
            
            // ì¶”ì„¸ ê°•ë„
            const strength = Math.min(100, Math.abs(parseFloat(prediction.indicators.momentum)) * 10);
            const strengthBar = document.getElementById('trendStrength');
            strengthBar.style.width = `${strength}%`;
            strengthBar.className = `h-2 rounded-full transition-all ${
                prediction.indicators.trend === 'bullish' ? 'bg-green-400' : 'bg-red-400'
            }`;
            
            // ì‹œì¥ ìƒíƒœ
            let marketStatus = 'ì¤‘ë¦½';
            if (prediction.indicators.rsi > 70) marketStatus = 'ê³¼ë§¤ìˆ˜';
            else if (prediction.indicators.rsi < 30) marketStatus = 'ê³¼ë§¤ë„';
            document.getElementById('marketStatus').textContent = marketStatus;
        }

        // í˜„ì¬ ê°€ê²© ì—…ë°ì´íŠ¸
        function updateCurrentPrice() {
            document.getElementById('currentPrice').textContent = 
                `$${currentPrice.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
        }

        // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateChart(prediction) {
            const labels = priceData.map(d => d.date);
            const prices = priceData.map(d => d.price);
            
            // ì˜ˆì¸¡ ë°ì´í„° ì¶”ê°€
            labels.push('ì˜ˆì¸¡');
            const predictedPrices = new Array(prices.length).fill(null);
            predictedPrices.push(prediction.price);
            
            // ì‹ ë¢°êµ¬ê°„ - ë§ˆì§€ë§‰ ì‹¤ì œ ê°€ê²©ë¶€í„° ì—°ê²°
            const upperBounds = new Array(prices.length - 1).fill(null);
            upperBounds.push(prices[prices.length - 1]); // ë§ˆì§€ë§‰ ì‹¤ì œ ê°€ê²©
            upperBounds.push(prediction.upperBound); // ì˜ˆì¸¡ ìƒí•œ
            
            const lowerBounds = new Array(prices.length - 1).fill(null);
            lowerBounds.push(prices[prices.length - 1]); // ë§ˆì§€ë§‰ ì‹¤ì œ ê°€ê²©
            lowerBounds.push(prediction.lowerBound); // ì˜ˆì¸¡ í•˜í•œ
            
            if (chart) {
                chart.data.labels = labels;
                chart.data.datasets[0].data = prices;
                chart.data.datasets[1].data = predictedPrices;
                chart.data.datasets[2].data = upperBounds;
                chart.data.datasets[3].data = lowerBounds;
                chart.update();
            } else {
                const ctx = document.getElementById('priceChart').getContext('2d');
                chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'ì‹¤ì œ ê°€ê²©',
                            data: prices,
                            borderColor: '#EF4444',
                            backgroundColor: 'transparent',
                            borderWidth: 2,
                            pointRadius: 4,
                            pointBackgroundColor: '#EF4444',
                            spanGaps: false
                        }, {
                            label: 'ì˜ˆì¸¡ ê°€ê²©',
                            data: predictedPrices,
                            borderColor: '#3B82F6',
                            backgroundColor: 'transparent',
                            borderWidth: 3,
                            borderDash: [5, 5],
                            pointRadius: 6,
                            pointBackgroundColor: '#3B82F6',
                            spanGaps: false
                        }, {
                            label: 'ì‹ ë¢°êµ¬ê°„ ìƒí•œ',
                            data: upperBounds,
                            borderColor: 'rgba(59, 130, 246, 0.5)',
                            backgroundColor: 'transparent',
                            borderWidth: 1,
                            borderDash: [3, 3],
                            pointRadius: 0,
                            spanGaps: true,
                            fill: false
                        }, {
                            label: 'ì‹ ë¢°êµ¬ê°„ í•˜í•œ',
                            data: lowerBounds,
                            borderColor: 'rgba(59, 130, 246, 0.5)',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 1,
                            borderDash: [3, 3],
                            pointRadius: 0,
                            spanGaps: true,
                            fill: '-1' // ì´ì „ ë°ì´í„°ì…‹(ìƒí•œ)ê¹Œì§€ ì±„ìš°ê¸°
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: '#9CA3AF',
                                    filter: function(item, chart) {
                                        // ì˜ˆì¸¡ ê°€ê²©ê³¼ ì‹¤ì œ ê°€ê²©ë§Œ ë²”ë¡€ì— í‘œì‹œ
                                        return item.text === 'ì‹¤ì œ ê°€ê²©' || item.text === 'ì˜ˆì¸¡ ê°€ê²©';
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed.y !== null) {
                                            label += '

        // ì—ëŸ¬ í‘œì‹œ
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.querySelector('span').textContent = message;
            errorDiv.classList.remove('hidden');
            setTimeout(() => errorDiv.classList.add('hidden'), 5000);
        }

        // ë°ì´í„° ë¡œë“œ
        async function loadData() {
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('mainContent').classList.add('hidden');
            
            priceData = await fetchHistoricalData();
            if (priceData.length > 0) {
                const price = await fetchCurrentPrice();
                if (price) currentPrice = price;
                
                updateCurrentPrice();
                
                const prediction = bayesianPredict();
                if (prediction) {
                    updateUI(prediction);
                    updateChart(prediction);
                }
                
                // ì‹œê°„ëŒ€ë³„ ì˜ˆì¸¡ ê³„ì‚°
                await calculateIntradayPredictions();
                
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('mainContent').classList.remove('hidden');
                
                connectWebSocket();
            }
        }

        // ì£¼ê¸°ì  ì˜ˆì¸¡ ì—…ë°ì´íŠ¸
        setInterval(() => {
            if (priceData.length > 0) {
                const prediction = bayesianPredict();
                if (prediction) {
                    updateUI(prediction);
                    updateChart(prediction);
                }
            }
        }, 5000);

        // ì‹œê°„ëŒ€ë³„ ì˜ˆì¸¡ ì£¼ê¸°ì  ì—…ë°ì´íŠ¸ (1ë¶„ë§ˆë‹¤)
        setInterval(() => {
            calculateIntradayPredictions();
        }, 60000);

        // ì´ˆê¸° ë¡œë“œ
        loadData();
    </script>
</body>
</html> + context.parsed.y.toLocaleString('en-US', {
                                                minimumFractionDigits: 2,
                                                maximumFractionDigits: 2
                                            });
                                        }
                                        return label;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                ticks: {
                                    color: '#9CA3AF',
                                    callback: function(value) {
                                        return '

        // ì—ëŸ¬ í‘œì‹œ
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.querySelector('span').textContent = message;
            errorDiv.classList.remove('hidden');
            setTimeout(() => errorDiv.classList.add('hidden'), 5000);
        }

        // ë°ì´í„° ë¡œë“œ
        async function loadData() {
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('mainContent').classList.add('hidden');
            
            priceData = await fetchHistoricalData();
            if (priceData.length > 0) {
                const price = await fetchCurrentPrice();
                if (price) currentPrice = price;
                
                updateCurrentPrice();
                
                const prediction = bayesianPredict();
                if (prediction) {
                    updateUI(prediction);
                    updateChart(prediction);
                }
                
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('mainContent').classList.remove('hidden');
                
                connectWebSocket();
            }
        }

        // ì£¼ê¸°ì  ì˜ˆì¸¡ ì—…ë°ì´íŠ¸
        setInterval(() => {
            if (priceData.length > 0) {
                const prediction = bayesianPredict();
                if (prediction) {
                    updateUI(prediction);
                    updateChart(prediction);
                }
            }
        }, 5000);

        // ì´ˆê¸° ë¡œë“œ
        loadData();
    </script>
</body>
</html> + value.toLocaleString();
                                    }
                                },
                                grid: {
                                    color: '#374151'
                                }
                            },
                            x: {
                                ticks: {
                                    color: '#9CA3AF'
                                },
                                grid: {
                                    color: '#374151'
                                }
                            }
                        }
                    }
                });
            }
        }

        // ì—ëŸ¬ í‘œì‹œ
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.querySelector('span').textContent = message;
            errorDiv.classList.remove('hidden');
            setTimeout(() => errorDiv.classList.add('hidden'), 5000);
        }

        // ë°ì´í„° ë¡œë“œ
        async function loadData() {
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('mainContent').classList.add('hidden');
            
            priceData = await fetchHistoricalData();
            if (priceData.length > 0) {
                const price = await fetchCurrentPrice();
                if (price) currentPrice = price;
                
                updateCurrentPrice();
                
                const prediction = bayesianPredict();
                if (prediction) {
                    updateUI(prediction);
                    updateChart(prediction);
                }
                
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('mainContent').classList.remove('hidden');
                
                connectWebSocket();
            }
        }

        // ì£¼ê¸°ì  ì˜ˆì¸¡ ì—…ë°ì´íŠ¸
        setInterval(() => {
            if (priceData.length > 0) {
                const prediction = bayesianPredict();
                if (prediction) {
                    updateUI(prediction);
                    updateChart(prediction);
                }
            }
        }, 5000);

        // ì´ˆê¸° ë¡œë“œ
        loadData();
    </script>
</body>
</html>
